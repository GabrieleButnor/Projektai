@model L2_veterinarija.ViewModels.VizitasAtaskViewModel

@{
    ViewBag.Title = "Vizitai";
}

<h2>Sudarytų vizitų ataskaita</h2>
<p><b>Parengta:</b> @DateTime.Now</p>

@using (Html.BeginForm())
{
    <div class="form-group">
        <label>Vizitai nuo: </label>
        @*<input class="form-inline date-picker" type="datetime" name="nuo" value="@Model.nuo" />*@
        @Html.EditorFor(model => model.nuo, new { @class = "date-picker" })
        <label>Vizitai iki: </label>
        @*<input class="form-inline date-picker" type="datetime" name="iki" value="@Model.iki" />*@
        @Html.EditorFor(model => model.iki, new { @class = "date-picker" })

        <label>Vizitų būsenos: </label>
        @Html.EditorFor(model => model.busena, new { @class = "text-danger" })
        <input class="btn btn-default" type="submit" value="Atrinkti">
    </div>
}


<table class="table table-striped">
    <tr style="background-color:lightblue">
        <th>
            @Html.DisplayNameFor(model => model.vizitai[0].numeris)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.vizitai[0].sudarymo_data)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.vizitai[0].busena)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.vizitai[0].gyvunas)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.vizitai[0].paslauguKaina)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.vizitai[0].prekeKaina)
        </th>
    </tr>

    @if (Model.vizitai.Count == 0)
    {
        <tr>
            <td colspan="8" align="center"><b style="color:red;">Nurodytame laikotarpyje nebuvo sudarytų tokios būsenos vizitų</b></td>
        </tr>
    }

    @for (int i = 0; i < Model.vizitai.Count; i++)
    {
        if (i == 0 || Model.vizitai[i].asmensKodas != Model.vizitai[i - 1].asmensKodas)
        {
            <tr style="background-color: lightblue">
                <td colspan="6" align="center"><b>@Model.vizitai[i].vardas @Model.vizitai[i].pavarde</b></td>
            </tr>
        }
            <tr>
                <td>#@Model.vizitai[i].numeris</td>
                <td>@Model.vizitai[i].sudarymo_data</td>
                <td>@Model.vizitai[i].busena</td>
                <td>@Model.vizitai[i].gyvunas</td>
                <td>@Model.vizitai[i].paslauguKaina</td>
                <td>@Model.vizitai[i].prekeKaina</td>
            </tr>

        if (i == Model.vizitai.Count - 1 || Model.vizitai[i].asmensKodas != Model.vizitai[i + 1].asmensKodas)
        {
            <tr>
                <td colspan="4"></td>
                <td><b>@Model.vizitai[i].bendraSumaPaslaugu</b></td>
                <td><b>@Model.vizitai[i].bendraSumaPrekiu</b></td>
            </tr>
        }

    }

    <tr style="background-color: lightblue">
        <td height="10px;" colspan="6" align="center"><b>Bendra suma</b></td>
    </tr>

    <tr>
        <td colspan="4"></td>
        <td>
            @Html.DisplayFor(modelItem => Model.visoSumaVaistu)
        </td>
        <td>
            @Html.DisplayFor(modelItem => Model.visoSumaPrekiu)
        </td>
    </tr>
</table>